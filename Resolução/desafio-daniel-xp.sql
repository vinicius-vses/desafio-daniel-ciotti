CREATE DATABASE IF NOT EXISTS desafio_daniel_xpinc;
USE desafio_daniel_xpinc;

CREATE TABLE INDEX_WEIGHTS (
    TICKER VARCHAR(10),
    INDICE VARCHAR(10),
    FONTE VARCHAR(10),
    QTO_TEORICA DECIMAL(20,2),
    PESO DECIMAL(10,4)
);

INSERT INTO INDEX_WEIGHTS (TICKER, INDICE, FONTE, QTO_TEORICA, PESO) VALUES
    ('VALE3', 'IBOV', 'B3', 4270903023, 12.0693),
    ('PETR4', 'IBOV', 'B3', 4431132660, 7.4851),
    ('ITUB4', 'IBOV', 'B3', 4455161368, 7.3277),
    ('PETR3', 'IBOV', 'B3', 2448348744, 4.5171),
    ('BBDCA', 'IBOV', 'B3', 5129958973, 3.6428),
    ('BBAS3', 'IBOV', 'B3', 2842613858, 3.4972),
    ('WEGE3', 'IBOV', 'B3', 1269032828, 3.3214),
    ('ELET3', 'IBOV', 'B3', 1780013881, 3.2058),
    ('BSP3', 'IBOV', 'B3', 683508570, 2.9119),
    ('ITSA4', 'IBOV', 'B3', 5504638590, 2.7373),
    ('B35A3', 'IBOV', 'B3', 5511401013, 2.7355),
    ('ABEV3', 'IBOV', 'B3', 4394835131, 2.6356),
    ('BPAC11', 'IBOV', 'B3', 1287247964, 1.9468),
    ('RENT3', 'IBOV', 'B3', 977700485, 1.9461),
    ('EQTL3', 'IBOV', 'B3', 1244602400, 1.8817),
    ('JBSS3', 'IBOV', 'B3', 1142696472, 1.8816),
    ('EMBR3', 'IBOV', 'B3', 734632601, 1.7056),
    ('SUZB3', 'IBOV', 'B3', 630821784, 1.6991),
    ('RDOR3', 'IBOV', 'B3', 1145289019, 1.5982),
    ('PRIO3', 'IBOV', 'B3', 798909771, 1.5551),
    ('RADL3', 'IBOV', 'B3', 1279770315, 1.5122),
    ('RAIL3', 'IBOV', 'B3', 1215994115, 1.0751),
    ('VBBR3', 'IBOV', 'B3', 1023392529, 1.0642),
    ('GGBR4', 'IBOV', 'B3', 1242683687, 1.0563),
    ('UGPA3', 'IBOV', 'B3', 1090134379, 1.0362);
    
    SELECT * FROM INDEX_WEIGHTS;
    
/* EXERCÍCIO 1 - Crie um Select que gere os 10 maiores Pesos do IBOV. */    
SELECT TICKER, INDICE, FONTE, QTO_TEORICA, PESO
FROM INDEX_WEIGHTS
WHERE INDICE = 'IBOV'
ORDER BY PESO DESC
LIMIT 10;

    SELECT * FROM INDEX_WEIGHTS;
    
/* EXERCÍCIO 2 - Utilizando a tabela do Exercício 1, adicionar os seguintes registros. */    
INSERT INTO INDEX_WEIGHTS (TICKER, INDICE, FONTE, QTO_TEORICA, PESO) VALUES
    ('ENEV3', 'IBOV', 'B3', 1579821370, 1.0324),
    ('BBSE3', 'IBOV', 'B3', 637332335, 1.0238),
    ('VIVT3', 'IBOV', 'B3', 407257128, 1.0213),
    ('CMIG4', 'IBOV', 'B3', 1858636840, 0.9616),
    ('BRFS3', 'IBOV', 'B3', 814523002, 0.9244);

/* EXERCÍCIO 3 - Escreva a query que atualize o peso do ativo ABEV3 para 3,5% na tabela INDEX_WEIGHTS. */    
SET SQL_SAFE_UPDATES = 0;
    
UPDATE INDEX_WEIGHTS
SET PESO = 3.5
WHERE TICKER = 'ABEV3';

SET SQL_SAFE_UPDATES = 1;

/* EXERCÍCIO 4 - Escreva a query que apague o registro de ITUB4 da tabela INDEX_WEIGHTS. */    
SET SQL_SAFE_UPDATES = 0;

DELETE FROM INDEX_WEIGHTS
WHERE TICKER = 'ITUB4';

SET SQL_SAFE_UPDATES = 1;
